
#cloud-config
package_update: true
package_upgrade: true

packages:
  - curl
  - ca-certificates
  - git
  - python3
  - python3-venv
  - nodejs
  - npm

write_files:
  - path: /opt/caldera/bootstrap.sh
    permissions: "0755"
    content: |
      #!/usr/bin/env bash
      set -euo pipefail

      SCRIPT_URL="https://raw.githubusercontent.com/dloder0/XDROps/main/install-caldera.sh"

      echo "[bootstrap] Downloading installer from: ${SCRIPT_URL}"
      mkdir -p /opt/caldera
      curl -fsSL "${SCRIPT_URL}" -o /opt/caldera/install-caldera.sh
      chmod +x /opt/caldera/install-caldera.sh

      echo "[bootstrap] Running installer..."
      /opt/caldera/install-caldera.sh

      echo "[bootstrap] Complete."

runcmd:
  - [ bash, -lc, "/opt/caldera/bootstrap.sh" ]
